# RDBMSのシャード

よくロードバランサ配下のアプリサーバーで例えられるが、本当にそうだろうか？  
答えはぜんぜん違う。

## シャードとは？

DBを**データ単位**で分割したもの

具体例を出すとこんな感じ。

- ユーザーID1～1,000,000 -> Shard1
- ユーザーID1,000,001～2,000,000 -> Shard２

あるデータの範囲で物理的にDBを別サーバーへ分割している。

## シャードする理由

- 単一のDBでは容量や性能限界に達する
- トラフィック増加に耐えられるようにする
- ホットスポットを分散する

## シャードのデメリット

シャードに伴い以下の課題は発生しがち。

- Join出来ない→アプリで対応
- トランザクションを跨ぐと難しくなる
- シャードを増やすとデータの再配置が発生する
- シャードはスケールアップ前提（スケールアウトはできない）

## FF14みたいなワールド分割とは違う？

FF14では、メテオサーバー、アルテマサーバーとワールドを分割している。  
これとは違うのだろうか？

シャーディングは、１つの巨大なサービスの分散スケール方法である。  
すべてのユーザーが１つの巨大なサービスにアクセスしているのは変わらない。  
シャードを跨いだjoinは相当難しい。

対して、  
DB分割は、独立したサービスによる分散スケール方法である。  
そのサーバーにアカウントを持つユーザーだけが、そのサーバーにアクセスできる。  
そもそも、別サービスなのでjoinが発生しない。  
当然、ユーザーIDも1から振り直されている。

その代わり、FF14では「DCトラベル」として、別サーバーへのログイン方法を別途用意している。  
もちろん、本当の処理は不明だが極論としては、「メテオサーバーのユーザーデータをアルテマサーバーに一時的にコピーして読み込む」ということをしている。
