# SSH Config

## ControlMaster

- no: マスター接続を使用しない。（デフォルト設定）
- yes/auto: マスター接続が存在しない場合、新しいマスター接続を作成する。
- ask: 新しいマスタ―接続を作成するかどうかをユーザーに確認する。
- autoask: 既存のマスター接続が無い場合、askの挙動を取る

1つのSSH接続で複数のセッションを共有する設定。  
新しくSSH接続を行う際に既存のセッション上で接続することになるため、認証情報の再入力が必要なくなる。

鍵を作っていれば問題ないが、作れない環境では有効化も？

## ControlPath ~/.ssh/<socket-file-name>

ControlMasterは、１つのソケットファイルで通信することでセッションを実現し、認証情報の再利用を可能にしている。  
その共有ソケットファイルのパスを設定する項目。

存在しないディレクトリを指定しても`mkdir -p`してくれるような便利機能は無い。  
必ず存在するディレクトリが必要なので、`.ssh`のディレクトリをそのまま利用することで解決する。

異なるホストやポート番号、ユーザー名に対応できるように特殊変数を使ったファイル名を指定しておくと便利である。

- %r: リモートユーザー名
- %h: ホスト名
- %p: ポート番号

## ControlPersist

- no: 切断時にマスター接続も切断する。（デフォルト設定）
- yes: 切断時に、マスター接続を**無期限**に保持する。`ssh -O`コマンドにより切断する必要がある。
- <時間指定>: 設定した時間だけ接続を保持する。
  - 3600: 単位が無い場合、秒と判断される。
  - 30m: mを付けると分単位だと判断される。
  - 1h : hを付けると時間単位だと判断される。

最後のセッションが終了した後にバックグラウンドでセッションを保持し続けてくれる時間。  
その間の再接続はセッションが生きているため認証情報の再入力は必要ない。

## ServerAliveInterval <sec>

- <時間指定>: ControlPersistと違って秒数のみ指定可能

`ServerAliveInterval`で設定した秒数が経過後、`KeepAlive`パケットを送信する。  
これによりサーバー側からの切断を防ぐことが出来る。

## ServerAliveCountMax

- <回数指定>: 最大値を指定

`KeepAlive`パケットが、この閾値以上に**連続して**送信された場合にsshセッションを切断する。  
`KeepAlive`パケットの間に別のパケットを送信した場合に、カウンターは0に上書きされる。
