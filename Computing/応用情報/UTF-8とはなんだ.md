# UTF-8 についてまとめてみた

……いが、知識がないのでちょくちょく追記しようかと。

## UTF-8 ってどんなの？

全部の文字を２バイトで表そうとした結果の成れの果て。  
上手くいったか？知らないです。  
まぁ、UTF-8 にすれば全員が幸せにはなれないけど、S-JIS とかよりマシなんじゃないですかね？  
“文字数”調べるとか楽そうだし（意味深）

## サロゲートペア

この世の文字をたった２バイト（=65526 通り）で表現しようとかムリゲーすぎたんですよ。  
ということで、一部の文字を４バイトで表現しようという話になりました。  
それが、上位サロゲートと下位サロゲートのペアです。

𩸽（ほっけ）という文字をエディタで見てみればいいです。  
U+29E3D と書かれているはずです。

は？４バイトってことは８文字だろって感じですけど、闇魔法によって５文字になっているのです。

## サロゲートペアの変換演算

サロゲートペアの文字コードについては、独自の変換規則（闇魔法）で４バイトのデータになっています。

1. 文字コードから 0x10000 を引いて１番左の桁を"2"→"1"にし、これを X とする。
2. X を 0x400 で割った商を 0xD800 に足す。これを「上位サロゲート」と呼ぶ。
3. X を 0x400 で割った余りを 0xDC00 に足す。これを「下位サロゲート」と呼ぶ。
4. 上位サロゲート、下位サロゲートの順番で出力する。

## 結局どうすればよかったんだろう？

サロゲートペアの片割れは１文字に判定するの？とか非常にメンドクサイことになってて文字コード戦士の明日は大変だと思います。

もう、はい UTF-256 ぐらい作れよ  
４億文字も顔文字入れられたら問題ないでしょ（慢心）
