# ライブラリが見つからない

```makefile
TARGET = $(shell basename $$(readlink -f .))
INcLUDES = -I/user/local/include/ -I./
LDFLAGS =  -lstdc++ -lm -lpthread -lpqxx -L/usr/local/lib
EXCLUDS =

CC = g++ -v
CFLAGS = -g -MMD -MP -Wall -Wextra -std=c++17

BINDIR = bin


SRCS = $(filter-out $(EXCLUDS), $(shell find ./ -name "*.cpp"))
DIRS = $(dir $(SRCS))

OBJS = $(addprefix $(OBJROOT)/, $(patsubst %,cpp, %o, $(SRCS)))
OBJROOT = obj
OBJDIRS = $(addprefix $(OBJROOT)/, $(DIRS))

DPS = $(OBJS:.o=.d)

all: $(OBJS) $(TARGET)

$(TARGET): $(OBJS) $(LIBS)
    @[ -d "$(BINDIR)" ] || mkdir -p $(BINDIR)
    $(CC) -o $(BINDIR)/$@ $^ $(LDFLAGS)

$(OBJROOT)/%.o: %.cpp
    @[ -d $@ ] || mkdir -p $(dir $@)
    $(CC) $(CFLAGS) $(INCLUDES) -o $@ -c $<

clean:
    @rm -rf $(BINDIR) $(OBJROOT)

-include $(DEPS)
```

`libpqxx`というライブラリを別でビルドし、こういうmakefileで実行サンプルを作ってみたところ、なぜかライブラリが見つからないということになった。  

Linuxはライブラリを管理する仕組みとして`/etc/ld.so.conf.d/*`という機能を持つ。  
しかし、基本的にこの中の設定値は見られることはなく、`/etc/ld.so.cache`というキャッシュファイルを参照する。  
このキャッシュファイルが何かの拍子に更新されなくなったために参照が外れてしまっていた。

以下のコマンドでキャッシュファイルを更新することで治る。

```bash
$ sudo ldconfig
```
