# 質とスピード

Q. 与えられた時間に対してやるべきことが多すぎる場合、どうするか？

- [ ] スコープを削る
- [ ] もっと人を増やす
- [ ] リリース日を延期する
- [x] 品質を魏整備する

> [アジャイルサムライ](https://www.amazon.co.jp/%E3%82%A2%E3%82%B8%E3%83%A3%E3%82%A4%E3%83%AB%E3%82%B5%E3%83%A0%E3%83%A9%E3%82%A4%E2%88%92%E9%81%94%E4%BA%BA%E9%96%8B%E7%99%BA%E8%80%85%E3%81%B8%E3%81%AE%E9%81%93%E2%88%92-Jonathan-Rasmusson/dp/4274068560):P.86

品質を犠牲にすれば短期的なスピードは得られる。  
ただし、中期的には逆効果になり、長期的には致命傷になる。

## 品質とは

品質とは誰かにとっての価値である。  
――― Gerald Weinberg [ワインバーグのシステム思考法](https://www.amazon.co.jp/%E3%83%AF%E3%82%A4%E3%83%B3%E3%83%90%E3%83%BC%E3%82%B0%E3%81%AE%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%80%9D%E8%80%83%E6%B3%95-%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E6%96%87%E5%8C%96%E3%82%92%E5%89%B5%E3%82%8B%E3%80%881%E3%80%89-G-M-%E3%83%AF%E3%82%A4%E3%83%B3%E3%83%90%E3%83%BC%E3%82%B0/dp/432002706X)

ソフトウェアの品質には、言い方は違えど以下の二つに分類される。

- 外部品質と内部品質
- 利用時の品質と製品品質
- 機能要件と日機能要件

顧客に影響する外部品質とチームに影響する内部品質である。  

> 「内部品質を作りこんだ結果として、外部品質として定義される特性の実現に近づくことができる。内部品質は結果ではなく原因であり、よいソフトウェアが備えているべきだ。」  
> ―――― [レガシーコードからの脱却 ―ソフトウェアの寿命を延ばし価値を高める9つのプラクティス](https://www.amazon.co.jp/%E3%83%AC%E3%82%AC%E3%82%B7%E3%83%BC%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E3%81%AE%E8%84%B1%E5%8D%B4-%E2%80%95%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%AE%E5%AF%BF%E5%91%BD%E3%82%92%E5%BB%B6%E3%81%B0%E3%81%97%E4%BE%A1%E5%80%A4%E3%82%92%E9%AB%98%E3%82%81%E3%82%8B9%E3%81%A4%E3%81%AE%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9-David-Scott-Bernstein/dp/4873118867)

## スピードを優先するとき、どんな内部品質が犠牲になるのか？

![Cavano and McCall's 11 "Quality Factors" (1978)](https://www.thomasalspaugh.org/pub/fnd/img/ility-Cavano+McCall-fig2.png)

プロダクトは、主に三つの品質辺によって構築される。  

- プロダクトの移行（Product Transition）
- プロダクトの運用（Product Operations）
- プロダクトの改定（Product Revision）

主にスピードを重視するときは、プロダクトの改定、つまり保守性を犠牲にすることが多い。  
では、この保守性とはどんなもので構成されているかを見てみたい。

![The 23 quality characteristics](https://www.thomasalspaugh.org/pub/fnd/img/ility-Boehm+Brown+Lipow1976-qesq-fig1.png)

> [Kinds of Software Quality("lities")](https://www.thomasalspaugh.org/pub/fnd/ility.html)　――― Barry Boehm(1976)

- Maintenability / 保守性
  - Testability / テスト容易性
  - Understandability / 理解容易性
  - Modifiability / 変更容易性

この三つをさらに掘り下げることもできるが、なんとなくわかるだろう

## 保守性を犠牲にすればスピードは上がるのか？

> 「あとでクリーンにすればいいよ。先に市場に出さなければ！」
>
> 開発者はそうやっていつもごまかす。だが、後でクリーンにすることはない。市場からのプレッシャーは止まらないからだ。  
> 「先に市場に出さなければ」とうことは、後ろに競合他社が大勢いるということである。競合他社に追い抜かれないためには、これからも走り続けるしかない。  
>
> その結果、開発者はモードを切り替えることができない。次の機能、また次の機能、またまた次の機能を追加することになる、コードをクリーンすることまで手が回らない。
>
> そして、崩壊が始まる。生産性がゼロに近づいていく。  
> ――― Bob Martin [Clean Architecture](https://www.amazon.co.jp/gp/product/4048930656) p.38

結論：

- 短期的には加速する
- 中期的には逆効果になる
- 長期的には致命傷になる

## 開発スピードを落とせば保守性は上がるのか？

加速することと保守性が下がることがトレードオフなら、  
減速することと保守性が上がることはトレードオフか？

> 経営的な要求に合わせて、**与えられた開発期間から、柔軟に汚さと速さを選択するというような器用な芸当はほとんど不可能**だ。  
> これは、極めて基礎的なところであれば多少はできるかもしれないが、実際には、ソースコードが汚くて遅い人もいれば、綺麗で速い人も多くいる。  
> ――― [エンジニアリング組織論への招待](https://www.amazon.co.jp/gp/product/4774196053)p.255

品質とスピードは制御変数ではないのだ。

> 品質を犠牲に数rのは、効果的なコントロール方法ではない。  
> 品質は制御変数ではない。
>
> 低品質を受け入れることで、プロジェクトが早くなることはない  
> 高品質を要求することで、プロジェクトが遅くなることはない
>
> むしろ、品質を高めることでデリバリーが高速になることは多い  
> 品質基準を下げてしまうと、デリバリーが遅くなり、予測できなくなってしまう  
> ――― Kent Beck [エクストリームプログラミング](https://www.amazon.co.jp/gp/product/4274217620) p.30

## どうすれば品質は上がるのか？

品質を上げるために必要なのは、知識と経験  
プログラマの成功体験や知識が品質を上げる。  
そのためには学び続ける必要がある。

||意図的な負債|変化による負債|学びによる負債|
|--:|:--|:--|:--|
|技術知識の問題|技術知識を正しく使わなかった|新しい技術が登場した|知らなかった技術を学んだ|
|ドメイン知識の問題|ドメイン知識を正しくコードに落とし込まなかった|ドメイン知識が変化した|知らなかった表現を見つけた|

- 技術知識
  - 言語やフレームワーク、ライブラリの正しい使い方
- ドメイン知識
  - 作っているサービスの知識

### 意図的な負債

「品質より速度優先」で発生する

A. コードの品質を犠牲にするのではなく、スコープを削るかリリース日を延長しろ

### 変化による負債

技術の進歩によって必ず訪れ、しかしそのタイミングを予測することは難しい負債。  

### 学びのよる負債

学んだのだから成長したのだ。  
ネガティブではなく、ポジティブに捕えよう

## 大事なメトリクス

- リードタイム
- デプロイ速度
- MTTR
- 変更失敗率

> LeanとDevOpsの科学

## 質とスピードの本当の関係

- 内部品質がスピードを生み
- スピードが学びのループを生み
- 学びのループが外部品質を生み
- 外部品質が競争力を生み
- 競争力が売上を生み
- 売上が内部品質を育む

> 質 v.s. スピードという二律背反の関係は**局所的**なものでしかない  
> 大域的には、**片方を犠牲にした場合、知らぬうちにもう一つも犠牲にしている**ということを忘れるな  
> ――― Evan Priestley @ Facebook

## では、内部品質への投資はいつ実るのか？

質とスピードの関係で、質への投資が有効ならば、投資に対する損益分岐点はいつ来るのか？  
「損益分岐点が10年後になるんですよ」と言われても、時期的にあまりに遠いし、その頃にまだ会社があるのか、自分がいるかも分からないのであれば、そうした投資へのモチベーションも下がってしまう。

所説も諸説でしかない

### およそ４回目のテストで投資は回収できる

> [Experiences of Test automation](https://www.amazon.co.jp/gp/product/B006RUFM5A)

### 一か月である

一カ月はすごい。３年後なら、もう担当者が代わっている可能性もあるが、１カ月ならほぼ確実に自分たちが享受できる。

![](https://martinfowler.com/articles/is-quality-worth-cost/both.png)

> [Is High Quality Software Worth the Cost?](https://martinfowler.com/articles/is-quality-worth-cost.html)  
> ――― Martin Fowler

## 質とスピードは何のトレードオフなのか？

教育なのかもしれない。

品質とスピードを追い求め、ベテランのみで開発を進めることで後続が育たない。  
それは多様性と教育が犠牲になっているのではないか？

## 参考

- [良いコードとは何か - エンジニア新卒研修 スライド公開](https://note.com/cyberz_cto/n/n26f535d6c575)
- [質とスピード](https://speakerdeck.com/twada/quality-and-speed-2020-spring-edition)
